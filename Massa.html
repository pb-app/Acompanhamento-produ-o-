<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Lan√ßamento - F√°brica de Massa</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/massa.css">
</head>
<body>
    <header><h1>F√°brica de Massa - Lan√ßamento</h1></header>

    <div class="nav-container">
        <a href="index.html" class="back-link">‚ùÆ Voltar para Produ√ß√£o Cer√¢mica</a>
    </div>

    <div class="container">
        <button id="openConfigBtn" title="Configura√ß√µes de Pesos e Metas">‚öôÔ∏è</button>
        
        <div class="tab-nav">
            <button class="tab-link active" onclick="showTab('producao')">Lan√ßamentos</button>
            <button class="tab-link" onclick="showTab('pesagem')">Pesagem</button>
            <button class="tab-link" onclick="showTab('dashboard')">Dashboard</button>
        </div>

        <div id="tabProducao" class="tab-content active">
            <section>
                <h2>Lan√ßar Produ√ß√£o</h2>
                <form id="formMassa">
                    <div> <label for="data">Data</label> <input type="date" id="data" required> </div>
                    <div> <label for="turno">Turno</label> 
                        <select id="turno" required> 
                            <option value="">Selecione um turno</option> 
                            <option>Comercial</option> <option>Turno 1 (6x2)</option> <option>Turno 2 (6x2)</option> 
                            <option>Turno 3 (6x2)</option> <option>Turno 4 (6x2)</option> <option>Turno 1 (5x2)</option> <option>Turno 2 (5x2)</option> 
                        </select> 
                    </div>
                    <div> <label for="qtdFT">Quantidade Filtro-prensagem (FT)</label> <input type="number" id="qtdFT" min="0" required> </div>
                    <div> <label for="qtdPlacas">Quantidade de Placas</label> <input type="number" id="qtdPlacas" min="0" value="0" required> </div>
                    
                    <fieldset class="paletes-fieldset">
                        <legend>Lan√ßamento de Paletes</legend>
                        <div class="palete-entry-row">
                            <select id="paleteSelect_1" class="palete-select"></select>
                            <input type="number" id="paleteQtd_1" class="palete-qtd" min="0" value="0" placeholder="Qtd.">
                            <div class="palete-peso-total">Peso: <output id="paletePesoTotal_1">0.00</output> kg</div>
                        </div>
                        <div class="palete-entry-row">
                            <select id="paleteSelect_2" class="palete-select"></select>
                            <input type="number" id="paleteQtd_2" class="palete-qtd" min="0" value="0" placeholder="Qtd.">
                            <div class="palete-peso-total">Peso: <output id="paletePesoTotal_2">0.00</output> kg</div>
                        </div>
                        <div class="palete-entry-row">
                             <select id="paleteSelect_3" class="palete-select"></select>
                            <input type="number" id="paleteQtd_3" class="palete-qtd" min="0" value="0" placeholder="Qtd.">
                             <div class="palete-peso-total">Peso: <output id="paletePesoTotal_3">0.00</output> kg</div>
                        </div>
                    </fieldset>
                    
                    <div class="full-width">
                        <label for="kgPalete">KG Total de Paletes (Calculado)</label>
                        <input type="number" id="kgPalete" step="0.1" min="0" readonly required>
                    </div>

                    <div class="full-width"> <label for="observacao">Observa√ß√£o</label> <textarea id="observacao" placeholder="Alguma observa√ß√£o..."></textarea> </div>
                    <div class="form-actions"> <button type="button" class="secondary" onclick="limparFormMassa()">Limpar</button> <button type="submit">Lan√ßar Produ√ß√£o</button> </div>
                </form>
            </section>
            
            <section class="history-section">
                <h2>Hist√≥rico de Produ√ß√£o</h2>
                <div class="filters">
                    <div> <label>Data In√≠cio</label> <input type="date" id="filtroDataInicio"> </div> 
                    <div> <label>Data Fim</label> <input type="date" id="filtroDataFim"> </div> 
                    <div> <label>Turno</label> 
                        <select id="filtroTurno"> 
                            <option value="">Todos os Turnos</option> 
                            <option>Comercial</option> <option>Turno 1 (6x2)</option> <option>Turno 2 (6x2)</option> 
                            <option>Turno 3 (6x2)</option> <option>Turno 4 (6x2)</option> <option>Turno 1 (5x2)</option> <option>Turno 2 (5x2)</option> 
                        </select> 
                    </div>
                    <button class="excel-btn" onclick="exportarExcel()">Exportar Excel</button>
                </div>
                <table>
                    <thead><tr><th></th><th>Data</th><th>Turno</th><th>% FT</th><th>% Palete</th><th>Retrabalho (kg)</th></tr></thead>
                    <tbody id="tabelaHistoricoBody"></tbody>
                </table>
            </section>
        </div>

        <div id="tabPesagem" class="tab-content">
            <section>
                <h2>Lan√ßar Peso de Palete/Mesa</h2>
                <form id="formPesagem">
                    <div><label for="dataPesagem">Data</label><input type="date" id="dataPesagem" required></div>
                    <div><label for="codigoPalete">C√≥digo do Palete/Mesa</label><input type="text" id="codigoPalete" required placeholder="Ex: P01, MESA-A"></div>
                    <div><label for="pesoTotalPalete">Peso Total (kg)</label><input type="number" id="pesoTotalPalete" step="0.1" min="0" required></div>
                    <div class="form-actions">
                        <button type="button" class="secondary" onclick="document.getElementById('formPesagem').reset();">Limpar</button>
                        <button type="submit">Lan√ßar Peso</button>
                    </div>
                </form>
            </section>
            <section class="history-section">
                 <h2>Hist√≥rico de Pesagem</h2>
                <table>
                    <thead><tr><th>Data</th><th>C√≥digo</th><th>Peso Total (kg)</th><th>A√ß√µes</th></tr></thead>
                    <tbody id="tabelaPesagemBody"></tbody>
                </table>
            </section>
        </div>

        <div id="tabDashboard" class="tab-content">
            <h2>Dashboard de Produ√ß√£o</h2>
            <div class="filters dashboard-filters">
                <div><label>Data In√≠cio</label><input type="date" id="dashFiltroDataInicio"></div>
                <div><label>Data Fim</label><input type="date" id="dashFiltroDataFim"></div>
                <div><label>Turno</label><select id="dashFiltroTurno"><option value="">Todos</option><option>Turno 1 (6x2)</option><option>Turno 2 (6x2)</option><option>Turno 3 (6x2)</option><option>Turno 4 (6x2)</option></select></div>
                <button id="printDashboardBtn" onclick="window.print()" style="background-color: var(--accent);">üñ®Ô∏è Imprimir</button>
            </div>

            <div class="kpi-grid">
                 <div class="kpi-card"><h3>Meta FT (kg)</h3> <div class="value" id="kpiTotalMeta">---</div></div>
                 <div class="kpi-card"><h3>Realizado FT (kg)</h3> <div class="value" id="kpiTotalRealizado">---</div></div>
                 <div class="kpi-card efficiency"><h3>Efici√™ncia</h3> <div class="value" id="kpiEficiencia">---</div></div>
                 <div class="kpi-card"><h3>Retrabalho (kg)</h3> <div class="value" id="kpiRetrabalho">---</div></div>
            </div>

            <div class="chart-grid">
                <div class="chart-container">
                     <h3>Produ√ß√£o por Turno (%)</h3>
                     <canvas id="pieChartTurnos"></canvas>
                </div>
                 <div class="chart-container">
                    <h3>Produ√ß√£o Mensal (12 Meses)</h3>
                    <select id="filtroTurnoGraficoMes" style="width: 100%; margin-bottom: 1rem;">
                        <option value="">Todos os Turnos</option>
                        <option>Comercial</option> <option>Turno 1 (6x2)</option> <option>Turno 2 (6x2)</option> <option>Turno 3 (6x2)</option> <option>Turno 4 (6x2)</option>
                    </select>
                    <canvas id="barChartMensal"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div id="configModal" class="modal-overlay">
        <div class="modal-content">
            <h3>Configura√ß√µes de Pesos e Metas</h3>
            <div class="config-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem; margin-bottom:1rem;">
                <div> <label>Peso por Filtro (kg)</label> <input type="number" id="pesoFiltro" step="0.1"> </div>
                <div> <label>Peso por Placa (kg)</label> <input type="number" id="pesoPlaca" step="0.1"> </div>
                <div> <label>Meta KG (Filtro)</label> <input type="number" id="metaKgFT" step="100"> </div>
                <div> <label>Meta KG (Paletes)</label> <input type="number" id="metaKgPalete" step="100"> </div>
            </div>
            <div class="modal-actions" style="display:flex; gap:1rem;">
                <input type="password" id="configSenha" placeholder="Senha para salvar" style="flex-grow: 1;">
                <button type="button" class="secondary" onclick="closeConfigModal(event, true)">Cancelar</button>
                <button onclick="salvarConfiguracoes()">Salvar</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/massa.js"></script>
</body>
</html>
